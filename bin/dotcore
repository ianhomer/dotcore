#!/usr/bin/env bash

set -e

$(shim) && cd ${DOTCORE_DIR} && . bin/i.sh

command_apply() {
  log:: "applying dotfiles"
  dotcore-pull
  dotcore-apt
  dotcore-stow
  dotcore-snap
  dotcore-projects
}

while getopts "F" opt; do
  case "$opt" in
  F)
    FORCE_ALL=1
    ;;
  esac
done

shift $((OPTIND - 1))
[ "${1:-}" == "--" ] && shift

if [[ -n "$FORCE_ALL" ]]; then
  for f in ${DOTCORE_DIR}/bin/dotcore-*; do
    should-run -c ${f##*/}
  done
fi

COMMAND=${1:-apply}
command_${COMMAND} $@
if [ $? = 127 ]; then
  echo "'$COMMAND_NAME' is not a known command or has errors." >&2
  usage
  exit 1
fi
