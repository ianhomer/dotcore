#!/usr/bin/env bash

#
# Install with apt
#

set -e

should-run -m 7 dotcore-apt || exit 0

$(shim) && cd ${DOTCORE_DIR} && . bin/i.sh

APT_ACCESS_RESPONSE=$(sudo -n -l apt)

if [ "${APT_ACCESS_RESPONSE}" == "/usr/bin/apt" ]; then
  log:: "updating apt"

  sudo apt update
  sudo apt install -y \
    git \
    stow \
    vim
elif [ "${APT_ACCESS_RESPONSE}" == "sudo: a password is required" ]; then
  log::warn "password is required for sudo to run apt"
  log::info "please run 'sudo apt update' manually and re-run"
  exit
else
  log::warn "user does not have permission to run apt."
  exit
fi

should-run -fu dotcore-apt
