#!/usr/bin/env bash

#
# Install with snap
#

set -e

should-run -m 7 $0 || exit 0

$(shim) && cd ${DOTCORE_DIR} && . bin/i.sh

if command -v snap >/dev/null; then
  SNAP_ACCESS_RESPONSE=$(sudo -n -l snap || true)

  if [ "${SNAP_ACCESS_RESPONSE}" == "/usr/bin/snap" ]; then
    log:: "updating snap"

    sudo snap refresh
    sudo snap install nvim --classic
  elif [ "${SNAP_ACCESS_RESPONSE}" == "sudo: a password is required" ]; then
    log::warn "password is required for sudo to run snap"
    log::info "please run 'sudo snap refresh' manually and re-run"
  else
    log::warn "user does not have permission to run snap"
  fi
else
  log::info "snap not installed, skipping"
  log::info "install with 'sudo apt install snapd'"
fi

should-run -fu $0
